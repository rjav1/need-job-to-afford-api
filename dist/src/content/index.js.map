{"version":3,"file":"index.js","sources":["../../../src/lib/form-memory.ts","../../../src/content/detector.ts","../../../src/lib/common-questions.ts","../../../src/lib/ai.ts","../../../src/lib/webhook.ts","../../../src/content/filler.ts","../../../src/lib/application-logger.ts","../../../src/content/index.ts"],"sourcesContent":["/**\n * Form Memory - Remember site patterns for faster future processing\n * Stores learned field mappings and site-specific configurations\n */\n\nimport { FieldType } from './types';\n\nexport interface FieldMapping {\n  // Identifiers to match\n  selectors: FieldSelector[];\n  // What field type this maps to\n  fieldType: FieldType;\n  // Confidence level (0-1)\n  confidence: number;\n  // Number of times this mapping was used successfully\n  successCount: number;\n  // Last used timestamp\n  lastUsed: number;\n}\n\nexport interface FieldSelector {\n  // CSS selector (if applicable)\n  cssSelector?: string;\n  // Element attributes\n  id?: string;\n  name?: string;\n  type?: string;\n  placeholder?: string;\n  ariaLabel?: string;\n  // Text patterns\n  labelPattern?: string;\n  nearbyTextPattern?: string;\n  // Data attributes\n  dataAttributes?: Record<string, string>;\n}\n\nexport interface SitePattern {\n  // Domain pattern (can include wildcards)\n  domain: string;\n  // Path pattern (optional)\n  pathPattern?: string;\n  // Known field mappings for this site\n  fieldMappings: FieldMapping[];\n  // Site-specific hints\n  hints: SiteHints;\n  // When this pattern was last updated\n  lastUpdated: number;\n  // Success rate for this site\n  successRate: number;\n  // Number of applications processed\n  applicationCount: number;\n}\n\nexport interface SiteHints {\n  // ATS type if known\n  atsType?: 'workday' | 'greenhouse' | 'lever' | 'icims' | 'taleo' | 'jobvite' | 'custom';\n  // Does the site use React/Vue/Angular?\n  framework?: 'react' | 'vue' | 'angular' | 'unknown';\n  // Does it have multi-step forms?\n  hasMultiStep?: boolean;\n  // Known selectors for next/submit buttons\n  nextButtonSelector?: string;\n  submitButtonSelector?: string;\n  // Fields that need special handling\n  specialFields?: Record<string, string>;\n  // Custom wait time between fields (ms)\n  fieldDelay?: number;\n}\n\n// Storage key prefix\nconst STORAGE_PREFIX = 'formMemory_';\nconst SITE_INDEX_KEY = 'formMemory_siteIndex';\n\n/**\n * Form Memory Manager - handles storing and retrieving site patterns\n */\nexport class FormMemory {\n  private cache: Map<string, SitePattern> = new Map();\n  private siteIndex: string[] = [];\n\n  constructor() {\n    this.loadSiteIndex();\n  }\n\n  /**\n   * Load the index of known sites\n   */\n  private async loadSiteIndex(): Promise<void> {\n    try {\n      const result = await chrome.storage.local.get(SITE_INDEX_KEY);\n      this.siteIndex = result[SITE_INDEX_KEY] || [];\n    } catch (e) {\n      console.log('[FormMemory] Error loading site index:', e);\n      this.siteIndex = [];\n    }\n  }\n\n  /**\n   * Save the site index\n   */\n  private async saveSiteIndex(): Promise<void> {\n    try {\n      await chrome.storage.local.set({ [SITE_INDEX_KEY]: this.siteIndex });\n    } catch (e) {\n      console.log('[FormMemory] Error saving site index:', e);\n    }\n  }\n\n  /**\n   * Get the domain key for a URL\n   */\n  private getDomainKey(url: string): string {\n    try {\n      const parsed = new URL(url);\n      // Remove www. prefix for consistency\n      return parsed.hostname.replace(/^www\\./, '');\n    } catch {\n      return 'unknown';\n    }\n  }\n\n  /**\n   * Get pattern for a site\n   */\n  async getPattern(url: string): Promise<SitePattern | null> {\n    const domain = this.getDomainKey(url);\n    \n    // Check cache first\n    if (this.cache.has(domain)) {\n      return this.cache.get(domain)!;\n    }\n    \n    // Load from storage\n    try {\n      const key = STORAGE_PREFIX + domain;\n      const result = await chrome.storage.local.get(key);\n      const pattern = result[key] as SitePattern | undefined;\n      \n      if (pattern) {\n        this.cache.set(domain, pattern);\n        return pattern;\n      }\n    } catch (e) {\n      console.log('[FormMemory] Error loading pattern:', e);\n    }\n    \n    return null;\n  }\n\n  /**\n   * Save or update pattern for a site\n   */\n  async savePattern(url: string, pattern: Partial<SitePattern>): Promise<void> {\n    const domain = this.getDomainKey(url);\n    \n    // Get existing pattern or create new\n    let existing = await this.getPattern(url);\n    \n    if (existing) {\n      // Merge patterns\n      existing = {\n        ...existing,\n        ...pattern,\n        fieldMappings: mergeFieldMappings(existing.fieldMappings, pattern.fieldMappings || []),\n        hints: { ...existing.hints, ...pattern.hints },\n        lastUpdated: Date.now(),\n      };\n    } else {\n      existing = {\n        domain,\n        fieldMappings: pattern.fieldMappings || [],\n        hints: pattern.hints || {},\n        lastUpdated: Date.now(),\n        successRate: 0,\n        applicationCount: 0,\n        ...pattern,\n      };\n    }\n    \n    // Save to cache and storage\n    this.cache.set(domain, existing);\n    \n    try {\n      const key = STORAGE_PREFIX + domain;\n      await chrome.storage.local.set({ [key]: existing });\n      \n      // Update index if new site\n      if (!this.siteIndex.includes(domain)) {\n        this.siteIndex.push(domain);\n        await this.saveSiteIndex();\n      }\n    } catch (e) {\n      console.log('[FormMemory] Error saving pattern:', e);\n    }\n  }\n\n  /**\n   * Record a successful field mapping\n   */\n  async recordSuccess(url: string, selector: FieldSelector, fieldType: FieldType): Promise<void> {\n    const pattern = await this.getPattern(url) || {\n      domain: this.getDomainKey(url),\n      fieldMappings: [],\n      hints: {},\n      lastUpdated: Date.now(),\n      successRate: 0,\n      applicationCount: 0,\n    };\n    \n    // Find existing mapping or create new\n    let mapping = pattern.fieldMappings.find(m => \n      m.fieldType === fieldType && selectorMatches(m.selectors, selector)\n    );\n    \n    if (mapping) {\n      mapping.successCount++;\n      mapping.confidence = Math.min(0.99, mapping.confidence + 0.05);\n      mapping.lastUsed = Date.now();\n    } else {\n      mapping = {\n        selectors: [selector],\n        fieldType,\n        confidence: 0.7,\n        successCount: 1,\n        lastUsed: Date.now(),\n      };\n      pattern.fieldMappings.push(mapping);\n    }\n    \n    await this.savePattern(url, pattern);\n  }\n\n  /**\n   * Record a failed field mapping (reduces confidence)\n   */\n  async recordFailure(url: string, selector: FieldSelector, fieldType: FieldType): Promise<void> {\n    const pattern = await this.getPattern(url);\n    if (!pattern) return;\n    \n    const mapping = pattern.fieldMappings.find(m => \n      m.fieldType === fieldType && selectorMatches(m.selectors, selector)\n    );\n    \n    if (mapping) {\n      mapping.confidence = Math.max(0.1, mapping.confidence - 0.1);\n    }\n    \n    await this.savePattern(url, pattern);\n  }\n\n  /**\n   * Record an application completion\n   */\n  async recordApplication(url: string, success: boolean): Promise<void> {\n    const pattern = await this.getPattern(url);\n    if (!pattern) return;\n    \n    pattern.applicationCount++;\n    \n    // Update success rate with exponential moving average\n    const alpha = 0.3;\n    pattern.successRate = alpha * (success ? 1 : 0) + (1 - alpha) * pattern.successRate;\n    \n    await this.savePattern(url, pattern);\n  }\n\n  /**\n   * Find field type from memory based on selector\n   */\n  async findFieldType(url: string, selector: FieldSelector): Promise<{ type: FieldType; confidence: number } | null> {\n    const pattern = await this.getPattern(url);\n    if (!pattern) return null;\n    \n    // Find best matching mapping\n    let bestMatch: FieldMapping | null = null;\n    let bestScore = 0;\n    \n    for (const mapping of pattern.fieldMappings) {\n      const score = calculateMatchScore(mapping.selectors, selector) * mapping.confidence;\n      if (score > bestScore && score > 0.3) {\n        bestScore = score;\n        bestMatch = mapping;\n      }\n    }\n    \n    if (bestMatch) {\n      return {\n        type: bestMatch.fieldType,\n        confidence: bestScore,\n      };\n    }\n    \n    return null;\n  }\n\n  /**\n   * Get all known sites\n   */\n  async getAllSites(): Promise<SitePattern[]> {\n    const patterns: SitePattern[] = [];\n    \n    for (const domain of this.siteIndex) {\n      try {\n        const key = STORAGE_PREFIX + domain;\n        const result = await chrome.storage.local.get(key);\n        if (result[key]) {\n          patterns.push(result[key]);\n        }\n      } catch (e) {\n        // Skip failed loads\n      }\n    }\n    \n    return patterns;\n  }\n\n  /**\n   * Clear all memory\n   */\n  async clearAll(): Promise<void> {\n    try {\n      const keysToRemove = this.siteIndex.map(d => STORAGE_PREFIX + d);\n      keysToRemove.push(SITE_INDEX_KEY);\n      await chrome.storage.local.remove(keysToRemove);\n      this.cache.clear();\n      this.siteIndex = [];\n    } catch (e) {\n      console.log('[FormMemory] Error clearing memory:', e);\n    }\n  }\n\n  /**\n   * Export memory to JSON\n   */\n  async export(): Promise<string> {\n    const patterns = await this.getAllSites();\n    return JSON.stringify(patterns, null, 2);\n  }\n\n  /**\n   * Import memory from JSON\n   */\n  async import(json: string): Promise<number> {\n    try {\n      const patterns = JSON.parse(json) as SitePattern[];\n      let imported = 0;\n      \n      for (const pattern of patterns) {\n        await this.savePattern(`https://${pattern.domain}`, pattern);\n        imported++;\n      }\n      \n      return imported;\n    } catch (e) {\n      console.log('[FormMemory] Error importing:', e);\n      throw e;\n    }\n  }\n}\n\n/**\n * Merge field mappings, combining selectors for same field types\n */\nfunction mergeFieldMappings(existing: FieldMapping[], newMappings: FieldMapping[]): FieldMapping[] {\n  const merged = [...existing];\n  \n  for (const newMapping of newMappings) {\n    const existingIdx = merged.findIndex(m => m.fieldType === newMapping.fieldType);\n    \n    if (existingIdx >= 0) {\n      // Merge selectors\n      const existingMapping = merged[existingIdx];\n      for (const selector of newMapping.selectors) {\n        if (!existingMapping.selectors.some(s => selectorEquals(s, selector))) {\n          existingMapping.selectors.push(selector);\n        }\n      }\n      // Update stats\n      existingMapping.successCount += newMapping.successCount;\n      existingMapping.confidence = Math.max(existingMapping.confidence, newMapping.confidence);\n    } else {\n      merged.push(newMapping);\n    }\n  }\n  \n  return merged;\n}\n\n/**\n * Check if two selectors are equivalent\n */\nfunction selectorEquals(a: FieldSelector, b: FieldSelector): boolean {\n  return a.id === b.id && \n         a.name === b.name && \n         a.type === b.type &&\n         a.labelPattern === b.labelPattern;\n}\n\n/**\n * Check if any selector in the list matches the target\n */\nfunction selectorMatches(selectors: FieldSelector[], target: FieldSelector): boolean {\n  return selectors.some(s => {\n    if (s.id && target.id && s.id === target.id) return true;\n    if (s.name && target.name && s.name === target.name) return true;\n    if (s.labelPattern && target.labelPattern) {\n      try {\n        const regex = new RegExp(s.labelPattern, 'i');\n        if (regex.test(target.labelPattern)) return true;\n      } catch {\n        if (s.labelPattern === target.labelPattern) return true;\n      }\n    }\n    return false;\n  });\n}\n\n/**\n * Calculate match score between selector list and target\n */\nfunction calculateMatchScore(selectors: FieldSelector[], target: FieldSelector): number {\n  let maxScore = 0;\n  \n  for (const selector of selectors) {\n    let score = 0;\n    let factors = 0;\n    \n    // ID match (strongest)\n    if (selector.id && target.id) {\n      factors++;\n      if (selector.id === target.id) score += 1.0;\n      else if (target.id.includes(selector.id) || selector.id.includes(target.id)) score += 0.5;\n    }\n    \n    // Name match\n    if (selector.name && target.name) {\n      factors++;\n      if (selector.name === target.name) score += 0.9;\n      else if (target.name.includes(selector.name) || selector.name.includes(target.name)) score += 0.4;\n    }\n    \n    // Type match\n    if (selector.type && target.type) {\n      factors++;\n      if (selector.type === target.type) score += 0.7;\n    }\n    \n    // Label pattern match\n    if (selector.labelPattern && target.labelPattern) {\n      factors++;\n      try {\n        const regex = new RegExp(selector.labelPattern, 'i');\n        if (regex.test(target.labelPattern)) score += 0.8;\n      } catch {\n        if (target.labelPattern.toLowerCase().includes(selector.labelPattern.toLowerCase())) {\n          score += 0.6;\n        }\n      }\n    }\n    \n    // Aria label match\n    if (selector.ariaLabel && target.ariaLabel) {\n      factors++;\n      if (selector.ariaLabel === target.ariaLabel) score += 0.8;\n      else if (target.ariaLabel.toLowerCase().includes(selector.ariaLabel.toLowerCase())) score += 0.5;\n    }\n    \n    // Placeholder match\n    if (selector.placeholder && target.placeholder) {\n      factors++;\n      if (selector.placeholder === target.placeholder) score += 0.7;\n      else if (target.placeholder.toLowerCase().includes(selector.placeholder.toLowerCase())) score += 0.4;\n    }\n    \n    // Normalize score\n    if (factors > 0) {\n      const normalizedScore = score / factors;\n      maxScore = Math.max(maxScore, normalizedScore);\n    }\n  }\n  \n  return maxScore;\n}\n\n/**\n * Create a selector from an element's attributes\n */\nexport function createSelectorFromElement(element: HTMLElement, labelText?: string): FieldSelector {\n  const selector: FieldSelector = {};\n  \n  if (element.id) selector.id = element.id;\n  if ((element as HTMLInputElement).name) selector.name = (element as HTMLInputElement).name;\n  if ((element as HTMLInputElement).type) selector.type = (element as HTMLInputElement).type;\n  if ((element as HTMLInputElement).placeholder) selector.placeholder = (element as HTMLInputElement).placeholder;\n  if (element.getAttribute('aria-label')) selector.ariaLabel = element.getAttribute('aria-label')!;\n  if (labelText) selector.labelPattern = labelText;\n  \n  // Extract data attributes\n  const dataAttrs: Record<string, string> = {};\n  for (const attr of element.attributes) {\n    if (attr.name.startsWith('data-') && attr.value) {\n      dataAttrs[attr.name] = attr.value;\n    }\n  }\n  if (Object.keys(dataAttrs).length > 0) {\n    selector.dataAttributes = dataAttrs;\n  }\n  \n  return selector;\n}\n\n// Singleton instance\nexport const formMemory = new FormMemory();\n\n// Built-in patterns for common ATS platforms\nexport const BUILTIN_PATTERNS: Record<string, Partial<SitePattern>> = {\n  'workday.com': {\n    hints: {\n      atsType: 'workday',\n      framework: 'react',\n      hasMultiStep: true,\n      nextButtonSelector: '[data-automation-id=\"bottom-navigation-next-button\"]',\n      submitButtonSelector: '[data-automation-id=\"bottom-navigation-next-button\"]',\n      fieldDelay: 300,\n    },\n  },\n  'myworkdayjobs.com': {\n    hints: {\n      atsType: 'workday',\n      framework: 'react',\n      hasMultiStep: true,\n      nextButtonSelector: '[data-automation-id=\"bottom-navigation-next-button\"]',\n      submitButtonSelector: '[data-automation-id=\"bottom-navigation-next-button\"]',\n      fieldDelay: 300,\n    },\n  },\n  'greenhouse.io': {\n    hints: {\n      atsType: 'greenhouse',\n      hasMultiStep: false,\n      submitButtonSelector: '#submit_app',\n      fieldDelay: 100,\n    },\n  },\n  'lever.co': {\n    hints: {\n      atsType: 'lever',\n      hasMultiStep: false,\n      submitButtonSelector: '.postings-btn-submit',\n      fieldDelay: 100,\n    },\n  },\n  'icims.com': {\n    hints: {\n      atsType: 'icims',\n      hasMultiStep: true,\n      fieldDelay: 200,\n    },\n  },\n  'taleo.net': {\n    hints: {\n      atsType: 'taleo',\n      hasMultiStep: true,\n      fieldDelay: 300,\n    },\n  },\n  'jobvite.com': {\n    hints: {\n      atsType: 'jobvite',\n      hasMultiStep: false,\n      fieldDelay: 150,\n    },\n  },\n};\n\n/**\n * Initialize built-in patterns for new installations\n */\nexport async function initBuiltinPatterns(): Promise<void> {\n  for (const [domain, pattern] of Object.entries(BUILTIN_PATTERNS)) {\n    const existing = await formMemory.getPattern(`https://${domain}`);\n    if (!existing) {\n      await formMemory.savePattern(`https://${domain}`, pattern);\n    }\n  }\n}\n","import { DetectedField, FieldType } from '../lib/types';\nimport { \n  detectFormsUniversally, \n  smartDetectField,\n  UniversalDetectionResult,\n  getSiteStats,\n  learnFromCorrection,\n  analyzePageWithVision\n} from '../lib/universal-form-detector';\nimport { initBuiltinPatterns, formMemory, BUILTIN_PATTERNS } from '../lib/form-memory';\nimport { analyzeDOMForForms, getDOMSnapshot } from '../lib/dom-analyzer';\n\n// Initialize built-in patterns on load\ninitBuiltinPatterns().catch(console.error);\n\n// Field detection patterns (legacy - kept for fast fallback)\nconst FIELD_PATTERNS: Record<FieldType, RegExp[]> = {\n  firstName: [/first\\s*name/i, /given\\s*name/i, /fname/i, /^first$/i],\n  lastName: [/last\\s*name/i, /surname/i, /family\\s*name/i, /lname/i, /^last$/i],\n  fullName: [/full\\s*name/i, /^name$/i, /your\\s*name/i, /legal\\s*name/i],\n  email: [/e-?mail/i, /email\\s*address/i],\n  phone: [/phone/i, /mobile/i, /cell/i, /telephone/i, /contact\\s*number/i],\n  address: [/street\\s*address/i, /address\\s*line/i, /^address$/i, /mailing\\s*address/i],\n  city: [/^city$/i, /city\\s*name/i],\n  state: [/^state$/i, /province/i, /region/i],\n  zipCode: [/zip/i, /postal/i, /post\\s*code/i],\n  country: [/country/i, /nation/i],\n  linkedin: [/linkedin/i, /linked-in/i],\n  github: [/github/i, /git-hub/i],\n  portfolio: [/portfolio/i, /website/i, /personal\\s*site/i, /url/i],\n  university: [/university/i, /college/i, /school/i, /institution/i, /alma\\s*mater/i],\n  degree: [/degree/i, /qualification/i, /diploma/i],\n  major: [/major/i, /field\\s*of\\s*study/i, /concentration/i, /specialization/i],\n  gpa: [/gpa/i, /grade\\s*point/i, /cumulative\\s*gpa/i],\n  graduationDate: [/graduat/i, /completion\\s*date/i, /expected\\s*graduat/i],\n  workAuthorization: [/work\\s*auth/i, /visa/i, /sponsor/i, /legal.*work/i, /authorized.*work/i, /citizenship/i],\n  yearsOfExperience: [/years?\\s*(of)?\\s*experience/i, /experience\\s*level/i, /how\\s*many\\s*years/i],\n  resume: [/resume/i, /cv/i, /curriculum/i],\n  coverLetter: [/cover\\s*letter/i, /letter\\s*of\\s*interest/i],\n  openEnded: [/why/i, /describe/i, /tell\\s*us/i, /explain/i, /what\\s*makes/i, /how\\s*would/i],\n  unknown: [],\n};\n\n// Detect field type from label text\nfunction detectFieldType(labelText: string, inputType: string, inputName: string): { type: FieldType; confidence: number } {\n  const text = `${labelText} ${inputName}`.toLowerCase();\n  \n  // Check for file inputs (resume)\n  if (inputType === 'file') {\n    if (/resume|cv/i.test(text)) return { type: 'resume', confidence: 0.95 };\n    if (/cover/i.test(text)) return { type: 'coverLetter', confidence: 0.9 };\n  }\n  \n  // Check each pattern\n  for (const [fieldType, patterns] of Object.entries(FIELD_PATTERNS)) {\n    for (const pattern of patterns) {\n      if (pattern.test(text)) {\n        return { type: fieldType as FieldType, confidence: 0.85 };\n      }\n    }\n  }\n  \n  // Check for textarea (likely open-ended)\n  if (inputType === 'textarea' && text.length > 20) {\n    return { type: 'openEnded', confidence: 0.7 };\n  }\n  \n  return { type: 'unknown', confidence: 0 };\n}\n\n// Get label text for an input element\nfunction getLabelText(element: HTMLElement): string {\n  // Check for associated label\n  const id = element.id;\n  if (id) {\n    const label = document.querySelector(`label[for=\"${id}\"]`);\n    if (label) return label.textContent?.trim() || '';\n  }\n  \n  // Check for parent label\n  const parentLabel = element.closest('label');\n  if (parentLabel) {\n    return parentLabel.textContent?.trim() || '';\n  }\n  \n  // Check for aria-label\n  const ariaLabel = element.getAttribute('aria-label');\n  if (ariaLabel) return ariaLabel;\n  \n  // Check for placeholder\n  const placeholder = element.getAttribute('placeholder');\n  if (placeholder) return placeholder;\n  \n  // Check for nearby text (previous sibling, parent div with text)\n  const parent = element.parentElement;\n  if (parent) {\n    const textNodes = Array.from(parent.childNodes)\n      .filter(n => n.nodeType === Node.TEXT_NODE)\n      .map(n => n.textContent?.trim())\n      .filter(Boolean);\n    if (textNodes.length) return textNodes[0] || '';\n    \n    // Check for span/div with label class\n    const labelSpan = parent.querySelector('.label, .field-label, [class*=\"label\"]');\n    if (labelSpan) return labelSpan.textContent?.trim() || '';\n  }\n  \n  return '';\n}\n\n// Custom dropdown selectors for Greenhouse, Workday, and other ATS platforms\nconst CUSTOM_DROPDOWN_SELECTORS = [\n  'button[aria-haspopup]',\n  '[role=\"combobox\"]',\n  '[role=\"listbox\"]',\n  // Greenhouse specific\n  '[data-qa=\"dropdown\"]',\n  '.select__control',\n  '[class*=\"select-dropdown\"]',\n  // Workday specific\n  '[data-automation-id*=\"select\"]',\n  '[data-automation-id*=\"dropdown\"]',\n  '.WDFC[data-automation-widget=\"wd-popup\"]',\n  // Generic custom selects\n  '.custom-select',\n  '[class*=\"dropdown-trigger\"]',\n  '[class*=\"select-trigger\"]',\n].join(', ');\n\n// Main detection function - uses fast regex-based detection\nexport function detectFormFields(): DetectedField[] {\n  const fields: DetectedField[] = [];\n  \n  // Find all form inputs (standard elements)\n  const inputs = document.querySelectorAll<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>(\n    'input:not([type=\"hidden\"]):not([type=\"submit\"]):not([type=\"button\"]), textarea, select'\n  );\n  \n  for (const input of inputs) {\n    // Skip invisible elements\n    if (!isVisible(input)) continue;\n    \n    const label = getLabelText(input);\n    const inputType = input.tagName.toLowerCase() === 'textarea' ? 'textarea' : \n                      (input as HTMLInputElement).type || 'text';\n    const inputName = input.name || input.id || '';\n    \n    const { type, confidence } = detectFieldType(label, inputType, inputName);\n    \n    if (type !== 'unknown' || label) {\n      fields.push({\n        element: input,\n        fieldType: type,\n        label: label,\n        isRequired: input.required || input.getAttribute('aria-required') === 'true',\n        confidence,\n      });\n    }\n  }\n  \n  // Find custom dropdown components (Greenhouse, Workday, etc.)\n  const customDropdowns = document.querySelectorAll<HTMLElement>(CUSTOM_DROPDOWN_SELECTORS);\n  \n  for (const dropdown of customDropdowns) {\n    // Skip if already captured or invisible\n    if (!isVisible(dropdown)) continue;\n    if (fields.some(f => f.element === dropdown || f.element.contains(dropdown) || dropdown.contains(f.element))) continue;\n    \n    const label = getLabelText(dropdown) || getDropdownLabel(dropdown);\n    const { type, confidence } = detectFieldType(label, 'select', dropdown.id || '');\n    \n    if (label || type !== 'unknown') {\n      fields.push({\n        element: dropdown as unknown as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement,\n        fieldType: type,\n        label: label,\n        isRequired: dropdown.getAttribute('aria-required') === 'true' || \n                    dropdown.closest('[data-required=\"true\"]') !== null ||\n                    !!dropdown.querySelector('[class*=\"required\"]'),\n        confidence: Math.max(confidence, 0.6), // Custom dropdowns get at least 0.6 confidence\n      });\n    }\n  }\n  \n  return fields;\n}\n\n// Get label for custom dropdown components\nfunction getDropdownLabel(element: HTMLElement): string {\n  // Check for aria-labelledby\n  const labelledBy = element.getAttribute('aria-labelledby');\n  if (labelledBy) {\n    const labelEl = document.getElementById(labelledBy);\n    if (labelEl) return labelEl.textContent?.trim() || '';\n  }\n  \n  // Check for nearby label by traversing up\n  let parent = element.parentElement;\n  for (let i = 0; i < 3 && parent; i++) {\n    const label = parent.querySelector('label, [class*=\"label\"]');\n    if (label && !element.contains(label)) {\n      return label.textContent?.trim() || '';\n    }\n    // Check previous sibling\n    const prev = parent.previousElementSibling;\n    if (prev && (prev.tagName === 'LABEL' || prev.classList.toString().includes('label'))) {\n      return prev.textContent?.trim() || '';\n    }\n    parent = parent.parentElement;\n  }\n  \n  // Check for title or data attributes\n  return element.getAttribute('title') || \n         element.getAttribute('data-label') || \n         element.getAttribute('data-placeholder') || '';\n}\n\n// Universal detection function - handles any site including custom components\nexport async function detectFormFieldsUniversal(): Promise<UniversalDetectionResult> {\n  return detectFormsUniversally();\n}\n\n// Hybrid detection - fast first, then universal fallback for unknowns\nexport async function detectFormFieldsHybrid(): Promise<DetectedField[]> {\n  // Start with fast regex-based detection\n  const fastFields = detectFormFields();\n  \n  // Count unknown fields\n  const unknownCount = fastFields.filter(f => f.fieldType === 'unknown').length;\n  const lowConfidenceCount = fastFields.filter(f => f.confidence < 0.5).length;\n  \n  // If too many unknowns or low confidence, use universal detection\n  if (unknownCount > fastFields.length * 0.3 || lowConfidenceCount > fastFields.length * 0.4) {\n    console.log('[Detector] Many unknowns, switching to universal detection');\n    const universalResult = await detectFormsUniversally();\n    \n    // Merge results, preferring higher confidence\n    const mergedFields: DetectedField[] = [];\n    \n    for (const uField of universalResult.fields) {\n      // Find matching fast field\n      const fastField = fastFields.find(f => f.element === uField.element);\n      \n      if (fastField && fastField.confidence > uField.confidence) {\n        mergedFields.push(fastField);\n      } else {\n        mergedFields.push(uField);\n      }\n    }\n    \n    // Add any fast fields not in universal results\n    for (const fField of fastFields) {\n      if (!mergedFields.some(m => m.element === fField.element)) {\n        mergedFields.push(fField);\n      }\n    }\n    \n    return mergedFields;\n  }\n  \n  // For fields still unknown, try smart detection individually\n  const enhancedFields = await Promise.all(\n    fastFields.map(async (field) => {\n      if (field.fieldType === 'unknown' || field.confidence < 0.5) {\n        const smartResult = await smartDetectField(field.element);\n        if (smartResult.confidence > field.confidence) {\n          return {\n            ...field,\n            fieldType: smartResult.type,\n            confidence: smartResult.confidence,\n          };\n        }\n      }\n      return field;\n    })\n  );\n  \n  return enhancedFields;\n}\n\n// Check if element is visible\nfunction isVisible(el: HTMLElement): boolean {\n  const style = window.getComputedStyle(el);\n  return style.display !== 'none' && \n         style.visibility !== 'hidden' && \n         style.opacity !== '0' &&\n         el.offsetParent !== null;\n}\n\n// Detect job page info (company, title)\nexport function detectJobInfo(): { company: string; title: string } {\n  const info = { company: '', title: '' };\n  \n  // LinkedIn\n  if (window.location.hostname.includes('linkedin.com')) {\n    info.company = document.querySelector('.jobs-unified-top-card__company-name')?.textContent?.trim() || \n                   document.querySelector('.topcard__org-name-link')?.textContent?.trim() || '';\n    info.title = document.querySelector('.jobs-unified-top-card__job-title')?.textContent?.trim() ||\n                 document.querySelector('.topcard__title')?.textContent?.trim() || '';\n  }\n  \n  // Greenhouse\n  if (window.location.hostname.includes('greenhouse.io')) {\n    info.company = document.querySelector('.company-name')?.textContent?.trim() ||\n                   document.querySelector('[class*=\"company\"]')?.textContent?.trim() || '';\n    info.title = document.querySelector('.app-title')?.textContent?.trim() ||\n                 document.querySelector('h1')?.textContent?.trim() || '';\n  }\n  \n  // Lever\n  if (window.location.hostname.includes('lever.co')) {\n    info.company = document.querySelector('.posting-headline h2')?.textContent?.trim() || '';\n    info.title = document.querySelector('.posting-headline h2')?.textContent?.trim() || '';\n  }\n  \n  // Workday\n  if (window.location.hostname.includes('workday.com') || window.location.hostname.includes('myworkdayjobs.com')) {\n    info.title = document.querySelector('[data-automation-id=\"jobPostingHeader\"]')?.textContent?.trim() ||\n                 document.querySelector('h1')?.textContent?.trim() || '';\n  }\n  \n  // Fallback - try to get from page title\n  if (!info.title && document.title) {\n    info.title = document.title.split(' - ')[0].split(' | ')[0].trim();\n  }\n  \n  return info;\n}\n\n// Get all open-ended questions (textareas with substantial labels)\nexport function detectOpenEndedQuestions(): DetectedField[] {\n  return detectFormFields().filter(f => \n    f.fieldType === 'openEnded' || \n    (f.element.tagName === 'TEXTAREA' && f.label.length > 15)\n  );\n}\n\n// Re-export types and functions for convenience\nexport type { UniversalDetectionResult };\nexport { \n  learnFromCorrection, \n  getSiteStats,\n  analyzePageWithVision,\n  formMemory, \n  BUILTIN_PATTERNS,\n  analyzeDOMForForms, \n  getDOMSnapshot \n};\n\n// Get detection summary for debugging/display\nexport async function getDetectionSummary(): Promise<{\n  totalFields: number;\n  knownFields: number;\n  unknownFields: number;\n  averageConfidence: number;\n  isKnownSite: boolean;\n  atsType?: string;\n  siteStats: { knownFields: number; successRate: number; applicationCount: number } | null;\n}> {\n  const result = await detectFormsUniversally();\n  const stats = await getSiteStats();\n  \n  const knownFields = result.fields.filter(f => f.fieldType !== 'unknown');\n  const unknownFields = result.fields.filter(f => f.fieldType === 'unknown');\n  \n  return {\n    totalFields: result.fields.length,\n    knownFields: knownFields.length,\n    unknownFields: unknownFields.length,\n    averageConfidence: result.confidence,\n    isKnownSite: result.isKnownSite,\n    atsType: result.atsType,\n    siteStats: stats,\n  };\n}\n\n// Check if current page is a job application\nexport function isJobApplicationPage(): boolean {\n  const url = window.location.href.toLowerCase();\n  const pageText = document.body.textContent?.toLowerCase() || '';\n  \n  // URL patterns\n  const urlPatterns = [\n    /apply/i, /application/i, /career/i, /job/i, /position/i,\n    /greenhouse/i, /lever/i, /workday/i, /icims/i, /taleo/i, /jobvite/i\n  ];\n  \n  if (urlPatterns.some(p => p.test(url))) return true;\n  \n  // Page content patterns\n  const contentPatterns = [\n    /apply\\s*(now|today|here)/i,\n    /job\\s*application/i,\n    /submit.*application/i,\n    /upload.*resume/i,\n    /cover\\s*letter/i,\n    /work\\s*authorization/i,\n    /years?\\s*of\\s*experience/i\n  ];\n  \n  if (contentPatterns.some(p => p.test(pageText))) return true;\n  \n  // Form detection - if we find common job application fields\n  const fields = detectFormFields();\n  const jobFieldTypes: FieldType[] = ['resume', 'coverLetter', 'workAuthorization', 'yearsOfExperience'];\n  const hasJobFields = fields.some(f => jobFieldTypes.includes(f.fieldType));\n  \n  return hasJobFields;\n}\n\n// ============================================\n// Multi-step Form Navigation Support\n// ============================================\n\n// Navigation button patterns for wizard-style forms\nconst NAVIGATION_BUTTON_PATTERNS = {\n  next: [\n    /^next$/i, /^continue$/i, /^proceed$/i, /^forward$/i,\n    /next\\s*step/i, /continue\\s*to/i, /save\\s*(&|and)\\s*continue/i,\n    /^weiter$/i, /^suivant$/i, /^siguiente$/i, // German, French, Spanish\n  ],\n  previous: [\n    /^back$/i, /^previous$/i, /^go\\s*back$/i,\n    /^zur√ºck$/i, /^pr√©c√©dent$/i, /^anterior$/i,\n  ],\n  submit: [\n    /^submit$/i, /submit\\s*application/i, /^apply$/i, /^apply\\s*now$/i,\n    /^finish$/i, /^complete$/i, /^done$/i, /^send$/i,\n  ],\n};\n\n// Selectors for navigation buttons\nconst NAVIGATION_BUTTON_SELECTORS = [\n  'button[type=\"submit\"]',\n  'button[type=\"button\"]',\n  'input[type=\"submit\"]',\n  'a.btn', 'a.button',\n  '[role=\"button\"]',\n  // ATS-specific\n  '[data-automation-id*=\"button\"]', // Workday\n  '[data-qa*=\"button\"]', // Greenhouse\n  '.application-actions button',\n  '.form-actions button',\n  '.wizard-actions button',\n  '.step-actions button',\n].join(', ');\n\nexport interface NavigationButton {\n  element: HTMLElement;\n  type: 'next' | 'previous' | 'submit';\n  text: string;\n  confidence: number;\n}\n\nexport interface WizardFormInfo {\n  isWizard: boolean;\n  currentStep?: number;\n  totalSteps?: number;\n  stepIndicators: HTMLElement[];\n  navigationButtons: NavigationButton[];\n  progressElement?: HTMLElement;\n}\n\n// Detect wizard/multi-step form structure\nexport function detectWizardForm(): WizardFormInfo {\n  const result: WizardFormInfo = {\n    isWizard: false,\n    stepIndicators: [],\n    navigationButtons: [],\n  };\n  \n  // Look for step indicators\n  const stepSelectors = [\n    '.step', '.wizard-step', '.progress-step', '[class*=\"step-indicator\"]',\n    '.stepper', '[role=\"progressbar\"]', '.breadcrumb-step',\n    '[data-automation-id*=\"step\"]', // Workday\n    '.application-progress', // Greenhouse\n  ];\n  \n  for (const selector of stepSelectors) {\n    const elements = document.querySelectorAll<HTMLElement>(selector);\n    if (elements.length > 1) {\n      result.stepIndicators = Array.from(elements);\n      result.isWizard = true;\n      \n      // Try to determine current and total steps\n      const active = Array.from(elements).findIndex(\n        el => el.classList.contains('active') || \n              el.classList.contains('current') ||\n              el.getAttribute('aria-current') === 'step'\n      );\n      if (active >= 0) {\n        result.currentStep = active + 1;\n        result.totalSteps = elements.length;\n      }\n      break;\n    }\n  }\n  \n  // Look for progress bar with step info\n  const progressBar = document.querySelector<HTMLElement>(\n    '[role=\"progressbar\"], .progress-bar, .application-progress, [class*=\"wizard-progress\"]'\n  );\n  if (progressBar) {\n    result.progressElement = progressBar;\n    result.isWizard = true;\n    \n    // Try to extract step info from aria attributes or text\n    const valueNow = progressBar.getAttribute('aria-valuenow');\n    const valueMax = progressBar.getAttribute('aria-valuemax');\n    if (valueNow && valueMax) {\n      result.currentStep = parseInt(valueNow);\n      result.totalSteps = parseInt(valueMax);\n    }\n  }\n  \n  // Detect navigation buttons\n  result.navigationButtons = detectNavigationButtons();\n  \n  // If we found next/previous buttons, it's likely a wizard\n  if (result.navigationButtons.some(b => b.type === 'next' || b.type === 'previous')) {\n    result.isWizard = true;\n  }\n  \n  return result;\n}\n\n// Detect navigation buttons (Next, Previous, Submit)\nexport function detectNavigationButtons(): NavigationButton[] {\n  const buttons: NavigationButton[] = [];\n  const candidates = document.querySelectorAll<HTMLElement>(NAVIGATION_BUTTON_SELECTORS);\n  \n  for (const element of candidates) {\n    if (!isVisible(element)) continue;\n    \n    // Get button text\n    const text = (\n      element.textContent?.trim() ||\n      element.getAttribute('aria-label') ||\n      element.getAttribute('value') ||\n      ''\n    ).toLowerCase();\n    \n    if (!text) continue;\n    \n    // Check against patterns\n    for (const [type, patterns] of Object.entries(NAVIGATION_BUTTON_PATTERNS) as [keyof typeof NAVIGATION_BUTTON_PATTERNS, RegExp[]][]) {\n      for (const pattern of patterns) {\n        if (pattern.test(text)) {\n          buttons.push({\n            element,\n            type,\n            text: element.textContent?.trim() || '',\n            confidence: 0.85,\n          });\n          break;\n        }\n      }\n    }\n  }\n  \n  // Deduplicate - prefer higher confidence or first found\n  const unique = new Map<HTMLElement, NavigationButton>();\n  for (const btn of buttons) {\n    const existing = unique.get(btn.element);\n    if (!existing || btn.confidence > existing.confidence) {\n      unique.set(btn.element, btn);\n    }\n  }\n  \n  return Array.from(unique.values());\n}\n\n// Get the next button if present\nexport function getNextButton(): HTMLElement | null {\n  const buttons = detectNavigationButtons();\n  const nextBtn = buttons.find(b => b.type === 'next');\n  return nextBtn?.element || null;\n}\n\n// Get the submit button if present\nexport function getSubmitButton(): HTMLElement | null {\n  const buttons = detectNavigationButtons();\n  const submitBtn = buttons.find(b => b.type === 'submit');\n  return submitBtn?.element || null;\n}\n\n// Check if we're on the final step of a wizard\nexport function isOnFinalStep(): boolean {\n  const wizard = detectWizardForm();\n  \n  if (!wizard.isWizard) return true; // Not a wizard, treat as final\n  \n  // If we have step info, check if current == total\n  if (wizard.currentStep && wizard.totalSteps) {\n    return wizard.currentStep >= wizard.totalSteps;\n  }\n  \n  // If we have a submit button but no next button, likely final step\n  const hasSubmit = wizard.navigationButtons.some(b => b.type === 'submit');\n  const hasNext = wizard.navigationButtons.some(b => b.type === 'next');\n  \n  return hasSubmit && !hasNext;\n}\n\n// Click the next/continue button to advance the form\nexport async function advanceToNextStep(): Promise<boolean> {\n  const nextBtn = getNextButton();\n  \n  if (!nextBtn) {\n    console.log('[Detector] No next button found');\n    return false;\n  }\n  \n  console.log('[Detector] Clicking next button:', nextBtn.textContent?.trim());\n  \n  // Simulate click\n  nextBtn.click();\n  \n  // Wait for potential page update\n  await new Promise(resolve => setTimeout(resolve, 500));\n  \n  return true;\n}\n","import { UserProfile } from './types';\n\n// Pre-built templates for common application questions\n// These can work WITHOUT AI if user has filled in their profile\n\nexport interface QuestionTemplate {\n  patterns: RegExp[];\n  generate: (profile: UserProfile, companyName?: string, jobTitle?: string) => string;\n}\n\nexport const COMMON_QUESTIONS: QuestionTemplate[] = [\n  // Why this company?\n  {\n    patterns: [\n      /why.*(this company|work here|join us|interested in.*company)/i,\n      /what attracts you to/i,\n      /why do you want to work/i,\n    ],\n    generate: (profile, company, job) => {\n      const skills = profile.skills.slice(0, 3).join(', ');\n      return `I'm excited about the opportunity at ${company || 'your company'} because it aligns perfectly with my background in ${profile.major || 'technology'}. With experience in ${skills || 'software development'}, I'm eager to contribute to innovative projects and grow alongside a talented team. The ${job || 'role'} particularly interests me as it would allow me to apply my skills while learning from industry leaders.`;\n    }\n  },\n  \n  // Tell us about yourself\n  {\n    patterns: [\n      /tell us about yourself/i,\n      /describe yourself/i,\n      /introduce yourself/i,\n      /who are you/i,\n    ],\n    generate: (profile) => {\n      const skills = profile.skills.slice(0, 4).join(', ');\n      const project = profile.projects[0];\n      let response = `I'm a ${profile.major || 'Computer Science'} student at ${profile.university || 'university'}, expected to graduate ${profile.graduationDate || 'soon'}. I have strong experience in ${skills || 'programming and software development'}.`;\n      if (project) {\n        response += ` Recently, I worked on ${project.name}, where I ${project.description.slice(0, 100)}...`;\n      }\n      return response;\n    }\n  },\n  \n  // Describe a project\n  {\n    patterns: [\n      /describe.*(project|work|experience)/i,\n      /tell us about a project/i,\n      /challenging project/i,\n      /proud of/i,\n      /accomplishment/i,\n    ],\n    generate: (profile) => {\n      const project = profile.projects[0];\n      if (project) {\n        const tech = project.technologies.join(', ');\n        return `One project I'm particularly proud of is ${project.name}. ${project.description} I used ${tech || 'various technologies'} to build this solution. ${project.highlights[0] || 'This project taught me valuable lessons about software development and problem-solving.'}`;\n      }\n      return `During my studies at ${profile.university || 'university'}, I've worked on several projects applying ${profile.skills.slice(0, 3).join(', ') || 'my technical skills'}. I enjoy tackling complex problems and building solutions that make a real impact.`;\n    }\n  },\n  \n  // Why this role/position?\n  {\n    patterns: [\n      /why.*(this role|this position|interested in.*role)/i,\n      /what interests you about this/i,\n    ],\n    generate: (profile, company, job) => {\n      const skills = profile.skills.slice(0, 3).join(', ');\n      return `The ${job || 'position'} excites me because it combines my passion for ${profile.major || 'technology'} with practical application. My experience with ${skills || 'relevant technologies'} has prepared me well for this role. I'm eager to contribute my skills while continuing to learn and grow in a professional environment.`;\n    }\n  },\n  \n  // Strengths\n  {\n    patterns: [\n      /strength/i,\n      /what are you good at/i,\n      /best qualities/i,\n    ],\n    generate: (profile) => {\n      const skills = profile.skills.slice(0, 2).join(' and ');\n      return `My key strengths include strong problem-solving abilities, proficiency in ${skills || 'technical skills'}, and excellent collaboration skills. I'm a quick learner who adapts well to new technologies and enjoys working in team environments to deliver quality results.`;\n    }\n  },\n  \n  // Weaknesses\n  {\n    patterns: [\n      /weakness/i,\n      /area.*(improve|development)/i,\n      /challenge.*overcome/i,\n    ],\n    generate: () => {\n      return `I sometimes focus too much on details, wanting to perfect every aspect of my work. I've learned to balance this by setting clear milestones and priorities, ensuring I deliver quality work while meeting deadlines. This attention to detail has actually become valuable in catching bugs and improving code quality.`;\n    }\n  },\n  \n  // Career goals / Where do you see yourself\n  {\n    patterns: [\n      /where.*see yourself/i,\n      /career goal/i,\n      /5 years/i,\n      /future/i,\n      /long.?term/i,\n    ],\n    generate: (profile, company) => {\n      return `In the next few years, I aim to grow into a senior technical role where I can both contribute to impactful projects and mentor others. I'm excited about ${company ? `opportunities at ${company}` : 'this opportunity'} because it aligns with my goal of working on meaningful ${profile.major?.toLowerCase().includes('data') ? 'data-driven' : 'software'} solutions while continuously developing my skills.`;\n    }\n  },\n  \n  // Availability / Start date\n  {\n    patterns: [\n      /when can you start/i,\n      /availability/i,\n      /start date/i,\n      /earliest.*start/i,\n    ],\n    generate: (profile) => {\n      if (profile.graduationDate) {\n        return `I am available to start after my graduation in ${profile.graduationDate}. I'm flexible and excited to begin as soon as possible.`;\n      }\n      return `I am available to start immediately and am flexible with the start date based on your team's needs.`;\n    }\n  },\n  \n  // Relocation\n  {\n    patterns: [\n      /willing to relocate/i,\n      /relocation/i,\n      /work location/i,\n    ],\n    generate: () => {\n      return `Yes, I am open to relocation for the right opportunity. I'm excited about new experiences and adapting to new environments.`;\n    }\n  },\n];\n\n// Find matching template for a question\nexport function findMatchingTemplate(question: string): QuestionTemplate | null {\n  for (const template of COMMON_QUESTIONS) {\n    for (const pattern of template.patterns) {\n      if (pattern.test(question)) {\n        return template;\n      }\n    }\n  }\n  return null;\n}\n\n// Generate response using template (no AI needed)\nexport function generateTemplateResponse(\n  question: string,\n  profile: UserProfile,\n  companyName?: string,\n  jobTitle?: string\n): string | null {\n  const template = findMatchingTemplate(question);\n  if (template) {\n    return template.generate(profile, companyName, jobTitle);\n  }\n  return null;\n}\n","import { AIResponseRequest, UserProfile, Settings } from './types';\nimport { storage } from './storage';\nimport { generateTemplateResponse } from './common-questions';\n\n// Generate AI response for open-ended questions\nexport async function generateAIResponse(request: AIResponseRequest): Promise<string> {\n  const settings = await storage.getSettings();\n  const apiKey = await storage.getApiKey();\n\n  // Try template-based response first (no AI needed)\n  const templateResponse = generateTemplateResponse(\n    request.question,\n    request.userProfile,\n    request.companyName,\n    request.jobTitle\n  );\n\n  // TEST MODE: Format for Discord and return placeholder\n  if ((settings as any).testMode) {\n    const discordMessage = formatForDiscord(request);\n    // Return a special response that the UI will handle\n    throw new TestModeError(discordMessage, templateResponse);\n  }\n\n  // If no API key or \"noAI\" mode, use template or return placeholder\n  if (!apiKey || (settings as any).noAiMode) {\n    if (templateResponse) {\n      return templateResponse;\n    }\n    throw new Error('No API key configured and no template available for this question. Please add your API key in settings or answer manually.');\n  }\n\n  // If we have a template and preferTemplates is enabled, use it\n  if (templateResponse && settings.preferTemplates) {\n    return templateResponse;\n  }\n  \n  const prompt = buildPrompt(request);\n\n  try {\n    if (settings.aiProvider === 'anthropic') {\n      return await callAnthropic(apiKey, prompt);\n    } else {\n      return await callOpenAI(apiKey, prompt);\n    }\n  } catch (error) {\n    // Fallback to template if AI fails\n    if (templateResponse) {\n      console.log('[AI Job Applier] AI failed, using template fallback');\n      return templateResponse;\n    }\n    throw error;\n  }\n}\n\n// Custom error for test mode\nexport class TestModeError extends Error {\n  discordMessage: string;\n  templateFallback: string | null;\n  \n  constructor(discordMessage: string, templateFallback: string | null) {\n    super('Test mode - check Discord');\n    this.discordMessage = discordMessage;\n    this.templateFallback = templateFallback;\n  }\n}\n\n// Format request for Discord\nfunction formatForDiscord(request: AIResponseRequest): string {\n  const skills = request.userProfile.skills.slice(0, 5).join(', ');\n  const project = request.userProfile.projects[0];\n  \n  return `**ü§ñ AI Job Applier Request**\n\n**Question:** ${request.question}\n\n**Company:** ${request.companyName || 'Unknown'}\n**Role:** ${request.jobTitle || 'Unknown'}\n\n**Applicant Context:**\n- Major: ${request.userProfile.major || 'N/A'}\n- University: ${request.userProfile.university || 'N/A'}\n- Skills: ${skills || 'N/A'}\n${project ? `- Project: ${project.name} - ${project.description.slice(0, 100)}...` : ''}\n\n@ronald please generate a response for this application question!`;\n}\n\nfunction buildPrompt(request: AIResponseRequest): string {\n  const { question, companyName, jobTitle, userProfile, maxLength } = request;\n  \n  const projectsText = userProfile.projects\n    .map(p => `- ${p.name}: ${p.description} (Technologies: ${p.technologies.join(', ')})`)\n    .join('\\n');\n\n  return `You are helping someone write a job application response. Be professional, enthusiastic, and specific.\n\nAPPLICANT BACKGROUND:\n- Name: ${userProfile.firstName} ${userProfile.lastName}\n- Education: ${userProfile.degree} in ${userProfile.major} from ${userProfile.university}\n- Skills: ${userProfile.skills.join(', ')}\n- Projects:\n${projectsText}\n\nJOB DETAILS:\n- Company: ${companyName}\n- Position: ${jobTitle}\n\nQUESTION TO ANSWER:\n\"${question}\"\n\nINSTRUCTIONS:\n- Write a compelling, personalized response\n- Reference specific skills or projects that are relevant\n- Show genuine interest in ${companyName}\n- Keep it concise but impactful\n${maxLength ? `- Maximum ${maxLength} characters` : '- Keep it to 3-4 sentences'}\n\nWrite the response directly, no preamble:`;\n}\n\nasync function callOpenAI(apiKey: string, prompt: string): Promise<string> {\n  const response = await fetch('https://api.openai.com/v1/chat/completions', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${apiKey}`,\n    },\n    body: JSON.stringify({\n      model: 'gpt-4o-mini',\n      messages: [{ role: 'user', content: prompt }],\n      max_tokens: 500,\n      temperature: 0.7,\n    }),\n  });\n\n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error.error?.message || 'OpenAI API error');\n  }\n\n  const data = await response.json();\n  return data.choices[0].message.content.trim();\n}\n\nasync function callAnthropic(apiKey: string, prompt: string): Promise<string> {\n  const response = await fetch('https://api.anthropic.com/v1/messages', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'x-api-key': apiKey,\n      'anthropic-version': '2023-06-01',\n    },\n    body: JSON.stringify({\n      model: 'claude-3-haiku-20240307',\n      max_tokens: 500,\n      messages: [{ role: 'user', content: prompt }],\n    }),\n  });\n\n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error.error?.message || 'Anthropic API error');\n  }\n\n  const data = await response.json();\n  return data.content[0].text.trim();\n}\n\n// Common question patterns and their types\nexport function detectQuestionType(question: string): string {\n  const q = question.toLowerCase();\n  \n  if (q.includes('why') && (q.includes('company') || q.includes('work here') || q.includes('join'))) {\n    return 'why_company';\n  }\n  if (q.includes('tell') && q.includes('yourself')) {\n    return 'about_yourself';\n  }\n  if (q.includes('project') || q.includes('challenge') || q.includes('difficult')) {\n    return 'project_experience';\n  }\n  if (q.includes('strength') || q.includes('weakness')) {\n    return 'strengths_weaknesses';\n  }\n  if (q.includes('why') && (q.includes('role') || q.includes('position') || q.includes('job'))) {\n    return 'why_role';\n  }\n  if (q.includes('where') && (q.includes('5 years') || q.includes('future') || q.includes('career'))) {\n    return 'career_goals';\n  }\n  \n  return 'general';\n}\n","// Webhook notification for successful job applications\nimport { DEFAULT_WEBHOOK_URL } from './types';\n\nexport interface WebhookPayload {\n  jobTitle: string;\n  company: string;\n  url: string;\n  fieldsFilledCount: number;\n  totalFields: number;\n  timestamp: string;\n  status: 'success' | 'partial' | 'error';\n  errorMessage?: string;\n}\n\n/**\n * Extract job info from the current page\n */\nexport function extractJobInfo(): { jobTitle: string; company: string } {\n  const info = { jobTitle: '', company: '' };\n  \n  // LinkedIn\n  if (window.location.hostname.includes('linkedin.com')) {\n    info.company = document.querySelector('.jobs-unified-top-card__company-name')?.textContent?.trim() || \n                   document.querySelector('.topcard__org-name-link')?.textContent?.trim() || '';\n    info.jobTitle = document.querySelector('.jobs-unified-top-card__job-title')?.textContent?.trim() ||\n                 document.querySelector('.topcard__title')?.textContent?.trim() || '';\n  }\n  \n  // Greenhouse\n  if (window.location.hostname.includes('greenhouse.io')) {\n    info.company = document.querySelector('.company-name')?.textContent?.trim() ||\n                   document.querySelector('[class*=\"company\"]')?.textContent?.trim() || '';\n    info.jobTitle = document.querySelector('.app-title')?.textContent?.trim() ||\n                 document.querySelector('h1')?.textContent?.trim() || '';\n  }\n  \n  // Lever\n  if (window.location.hostname.includes('lever.co')) {\n    const headline = document.querySelector('.posting-headline h2')?.textContent?.trim() || '';\n    info.company = headline;\n    info.jobTitle = headline;\n  }\n  \n  // Workday\n  if (window.location.hostname.includes('workday.com') || window.location.hostname.includes('myworkdayjobs.com')) {\n    info.jobTitle = document.querySelector('[data-automation-id=\"jobPostingHeader\"]')?.textContent?.trim() ||\n                 document.querySelector('h1')?.textContent?.trim() || '';\n  }\n  \n  // Fallback - try to get from page title\n  if (!info.jobTitle && document.title) {\n    info.jobTitle = document.title.split(' - ')[0].split(' | ')[0].trim();\n  }\n  \n  return info;\n}\n\n/**\n * Send a Discord webhook notification for a job application fill\n */\nexport async function sendWebhookNotification(\n  payload: WebhookPayload,\n  webhookUrl?: string\n): Promise<boolean> {\n  const url = webhookUrl || DEFAULT_WEBHOOK_URL;\n  \n  try {\n    // Build Discord embed\n    const statusEmoji = payload.status === 'success' ? '‚úÖ' : payload.status === 'partial' ? '‚ö†Ô∏è' : '‚ùå';\n    const statusColor = payload.status === 'success' ? 0x10b981 : payload.status === 'partial' ? 0xf59e0b : 0xef4444;\n    \n    const embed = {\n      title: `${statusEmoji} Job Application Auto-Filled`,\n      color: statusColor,\n      fields: [\n        {\n          name: 'üíº Job Title',\n          value: payload.jobTitle || 'Unknown',\n          inline: true,\n        },\n        {\n          name: 'üè¢ Company',\n          value: payload.company || 'Unknown',\n          inline: true,\n        },\n        {\n          name: 'üìù Fields Filled',\n          value: `${payload.fieldsFilledCount} / ${payload.totalFields}`,\n          inline: true,\n        },\n        {\n          name: 'üîó Application URL',\n          value: payload.url.length > 100 \n            ? `[Open Application](${payload.url})` \n            : payload.url || 'N/A',\n          inline: false,\n        },\n      ],\n      timestamp: payload.timestamp,\n      footer: {\n        text: 'AI Job Applier Extension',\n      },\n    };\n\n    // Add error message if any\n    if (payload.errorMessage) {\n      embed.fields.push({\n        name: '‚ö†Ô∏è Issues',\n        value: payload.errorMessage.slice(0, 200),\n        inline: false,\n      });\n    }\n\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        embeds: [embed],\n      }),\n    });\n\n    if (!response.ok) {\n      console.error('[AI Job Applier] Webhook failed:', response.status, await response.text());\n      return false;\n    }\n\n    console.log('[AI Job Applier] Webhook notification sent successfully');\n    return true;\n  } catch (error) {\n    console.error('[AI Job Applier] Webhook error:', error);\n    return false;\n  }\n}\n","import { DetectedField, UserProfile, FieldType } from '../lib/types';\nimport { storage } from '../lib/storage';\nimport { generateAIResponse, TestModeError } from '../lib/ai';\nimport { detectJobInfo } from './detector';\nimport { sendWebhookNotification, extractJobInfo } from '../lib/webhook';\n\n// Fill a single field with the appropriate value\nexport async function fillField(\n  field: DetectedField, \n  profile: UserProfile,\n  options: { useAI: boolean } = { useAI: true }\n): Promise<boolean> {\n  const value = getFieldValue(field.fieldType, profile);\n  \n  if (value !== null) {\n    // Use AI-driven selection for dropdowns\n    if (field.element instanceof HTMLSelectElement) {\n      await setInputValueAsync(field.element, value, field.label);\n    } else {\n      setInputValue(field.element, value);\n    }\n    return true;\n  }\n  \n  // For open-ended questions, use AI\n  if (field.fieldType === 'openEnded' && options.useAI) {\n    const jobInfo = detectJobInfo();\n    try {\n      const response = await generateAIResponse({\n        question: field.label,\n        companyName: jobInfo.company,\n        jobTitle: jobInfo.title,\n        userProfile: profile,\n      });\n      setInputValue(field.element, response);\n      return true;\n    } catch (error) {\n      // Handle test mode - show Discord prompt\n      if (error instanceof TestModeError) {\n        showTestModeDialog(error, field.element);\n        return false;\n      }\n      console.error('AI response error:', error);\n      return false;\n    }\n  }\n  \n  return false;\n}\n\n// Show dialog for test mode (Discord-based AI)\nfunction showTestModeDialog(error: TestModeError, targetElement: HTMLElement): void {\n  const existing = document.getElementById('ai-job-applier-test-dialog');\n  if (existing) existing.remove();\n  \n  const dialog = document.createElement('div');\n  dialog.id = 'ai-job-applier-test-dialog';\n  dialog.innerHTML = `\n    <div class=\"test-dialog-content\">\n      <h3>üß™ Test Mode - Discord AI</h3>\n      <p>Copy this to Discord <strong>#job-applier-ai</strong> channel:</p>\n      <textarea id=\"discord-request\" readonly>${error.discordMessage}</textarea>\n      <button id=\"copy-discord-btn\" class=\"ai-btn primary\">üìã Copy to Clipboard</button>\n      \n      <hr>\n      \n      <p>Then paste Ronald's response here:</p>\n      <textarea id=\"ai-response-input\" placeholder=\"Paste the AI response here...\"></textarea>\n      <button id=\"use-response-btn\" class=\"ai-btn primary\">‚úÖ Use This Response</button>\n      \n      ${error.templateFallback ? `\n        <hr>\n        <p>Or use the template response:</p>\n        <button id=\"use-template-btn\" class=\"ai-btn secondary\">üìù Use Template Instead</button>\n      ` : ''}\n      \n      <button id=\"close-dialog-btn\" class=\"ai-btn secondary\">‚ùå Cancel</button>\n    </div>\n  `;\n  \n  // Add styles\n  const style = document.createElement('style');\n  style.textContent = `\n    #ai-job-applier-test-dialog {\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0,0,0,0.7);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 9999999;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    }\n    .test-dialog-content {\n      background: white;\n      padding: 24px;\n      border-radius: 16px;\n      max-width: 600px;\n      width: 90%;\n      max-height: 80vh;\n      overflow-y: auto;\n    }\n    .test-dialog-content h3 {\n      margin: 0 0 16px;\n      color: #667eea;\n    }\n    .test-dialog-content p {\n      margin: 8px 0;\n      color: #475569;\n      font-size: 14px;\n    }\n    .test-dialog-content textarea {\n      width: 100%;\n      min-height: 100px;\n      padding: 12px;\n      border: 1px solid #e2e8f0;\n      border-radius: 8px;\n      font-size: 13px;\n      margin: 8px 0;\n      resize: vertical;\n    }\n    .test-dialog-content hr {\n      border: none;\n      border-top: 1px solid #e2e8f0;\n      margin: 16px 0;\n    }\n    .test-dialog-content .ai-btn {\n      display: block;\n      width: 100%;\n      padding: 12px;\n      border: none;\n      border-radius: 8px;\n      font-size: 14px;\n      cursor: pointer;\n      margin: 8px 0;\n    }\n    .test-dialog-content .ai-btn.primary {\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n    }\n    .test-dialog-content .ai-btn.secondary {\n      background: #f1f5f9;\n      color: #475569;\n    }\n  `;\n  dialog.appendChild(style);\n  document.body.appendChild(dialog);\n  \n  // Event handlers\n  dialog.querySelector('#copy-discord-btn')?.addEventListener('click', () => {\n    navigator.clipboard.writeText(error.discordMessage);\n    (dialog.querySelector('#copy-discord-btn') as HTMLElement).textContent = '‚úÖ Copied!';\n  });\n  \n  dialog.querySelector('#use-response-btn')?.addEventListener('click', () => {\n    const response = (dialog.querySelector('#ai-response-input') as HTMLTextAreaElement).value;\n    if (response.trim()) {\n      setInputValue(targetElement as any, response.trim());\n      highlightField(targetElement, 'success');\n      dialog.remove();\n    }\n  });\n  \n  dialog.querySelector('#use-template-btn')?.addEventListener('click', () => {\n    if (error.templateFallback) {\n      setInputValue(targetElement as any, error.templateFallback);\n      highlightField(targetElement, 'success');\n      dialog.remove();\n    }\n  });\n  \n  dialog.querySelector('#close-dialog-btn')?.addEventListener('click', () => {\n    dialog.remove();\n  });\n}\n\n// Get value from profile for a field type\nfunction getFieldValue(fieldType: FieldType, profile: UserProfile): string | null {\n  const mapping: Partial<Record<FieldType, string>> = {\n    firstName: profile.firstName,\n    lastName: profile.lastName,\n    fullName: `${profile.firstName} ${profile.lastName}`.trim(),\n    email: profile.email,\n    phone: profile.phone,\n    address: profile.address,\n    city: profile.city,\n    state: profile.state,\n    zipCode: profile.zipCode,\n    country: profile.country,\n    linkedin: profile.linkedinUrl,\n    github: profile.githubUrl,\n    portfolio: profile.portfolioUrl,\n    university: profile.university,\n    degree: profile.degree,\n    major: profile.major,\n    gpa: profile.gpa,\n    graduationDate: profile.graduationDate,\n    yearsOfExperience: profile.yearsOfExperience,\n  };\n  \n  return mapping[fieldType] || null;\n}\n\n// AI-driven dropdown selection - no hardcoded fallbacks\nasync function findBestOptionWithAI(\n  options: HTMLOptionElement[], \n  targetValue: string,\n  fieldLabel: string\n): Promise<HTMLOptionElement | null> {\n  const target = targetValue.toLowerCase().trim();\n  \n  // 1. Exact match (no AI needed)\n  let match = options.find(opt => \n    opt.value.toLowerCase() === target || \n    opt.text.toLowerCase() === target\n  );\n  if (match) return match;\n  \n  // 2. Contains match (no AI needed)\n  match = options.find(opt => \n    opt.value.toLowerCase().includes(target) ||\n    opt.text.toLowerCase().includes(target) ||\n    target.includes(opt.value.toLowerCase()) ||\n    target.includes(opt.text.toLowerCase())\n  );\n  if (match) return match;\n  \n  // 3. AI-driven selection for non-obvious matches\n  const optionTexts = options.map((opt, i) => `${i}: ${opt.text}`).join('\\n');\n  \n  try {\n    const settings = await storage.getSettings();\n    const apiKey = await storage.getApiKey();\n    \n    if (!apiKey && !(settings as any).testMode) {\n      // Fallback to fuzzy match if no AI available\n      return fuzzyMatch(options, target);\n    }\n    \n    const prompt = `You are helping fill a job application form.\n\nField: \"${fieldLabel}\"\nUser's value: \"${targetValue}\"\n\nAvailable dropdown options:\n${optionTexts}\n\nWhich option number (0-${options.length - 1}) is the BEST match for the user's value? \nConsider semantic similarity - e.g., \"Computer Engineering\" could match \"Computer Science\" or \"Electrical Engineering\".\nFor yes/no questions, match appropriately.\n\nReply with ONLY the option number, nothing else. If no good match exists, reply \"NONE\".`;\n\n    const response = await callAIForDropdown(apiKey, prompt, settings.aiProvider);\n    const trimmed = response.trim();\n    \n    if (trimmed === 'NONE') {\n      return fuzzyMatch(options, target);\n    }\n    \n    const index = parseInt(trimmed, 10);\n    if (!isNaN(index) && index >= 0 && index < options.length) {\n      console.log(`[AI Job Applier] AI selected option ${index}: \"${options[index].text}\" for value \"${targetValue}\"`);\n      return options[index];\n    }\n  } catch (error) {\n    console.log('[AI Job Applier] AI dropdown selection failed, using fuzzy match:', error);\n  }\n  \n  // Fallback to fuzzy match\n  return fuzzyMatch(options, target);\n}\n\n// Simple fuzzy match as fallback\nfunction fuzzyMatch(options: HTMLOptionElement[], target: string): HTMLOptionElement | null {\n  const targetWords = target.toLowerCase().split(/\\s+/);\n  let bestMatch: HTMLOptionElement | null = null;\n  let bestScore = 0;\n  \n  for (const opt of options) {\n    const optText = (opt.value + ' ' + opt.text).toLowerCase();\n    const optWords = optText.split(/\\s+/);\n    const overlap = targetWords.filter(w => optWords.some(ow => ow.includes(w) || w.includes(ow))).length;\n    if (overlap > bestScore) {\n      bestScore = overlap;\n      bestMatch = opt;\n    }\n  }\n  \n  return bestScore > 0 ? bestMatch : null;\n}\n\n// Quick AI call for dropdown selection\nasync function callAIForDropdown(apiKey: string, prompt: string, provider: string): Promise<string> {\n  if (provider === 'anthropic') {\n    const response = await fetch('https://api.anthropic.com/v1/messages', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'x-api-key': apiKey,\n        'anthropic-version': '2023-06-01',\n      },\n      body: JSON.stringify({\n        model: 'claude-3-haiku-20240307',\n        max_tokens: 10,\n        messages: [{ role: 'user', content: prompt }],\n      }),\n    });\n    const data = await response.json();\n    return data.content[0].text;\n  } else {\n    const response = await fetch('https://api.openai.com/v1/chat/completions', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${apiKey}`,\n      },\n      body: JSON.stringify({\n        model: 'gpt-4o-mini',\n        messages: [{ role: 'user', content: prompt }],\n        max_tokens: 10,\n      }),\n    });\n    const data = await response.json();\n    return data.choices[0].message.content;\n  }\n}\n\n// Sync version for backward compatibility (uses fuzzy only)\nfunction findBestOption(options: HTMLOptionElement[], targetValue: string): HTMLOptionElement | null {\n  const target = targetValue.toLowerCase().trim();\n  \n  // Exact match\n  let match = options.find(opt => \n    opt.value.toLowerCase() === target || \n    opt.text.toLowerCase() === target\n  );\n  if (match) return match;\n  \n  // Contains match\n  match = options.find(opt => \n    opt.value.toLowerCase().includes(target) ||\n    opt.text.toLowerCase().includes(target) ||\n    target.includes(opt.value.toLowerCase()) ||\n    target.includes(opt.text.toLowerCase())\n  );\n  if (match) return match;\n  \n  // Fuzzy match\n  return fuzzyMatch(options, target);\n}\n\n// Set value on input element (handles different input types)\nasync function setInputValueAsync(\n  element: HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement, \n  value: string,\n  fieldLabel: string = ''\n): Promise<void> {\n  // Dispatch events to trigger any validation/listeners\n  const inputEvent = new Event('input', { bubbles: true });\n  const changeEvent = new Event('change', { bubbles: true });\n  \n  if (element instanceof HTMLSelectElement) {\n    // For select, use AI-driven matching\n    const options = Array.from(element.options).filter(opt => opt.value); // exclude empty options\n    const match = await findBestOptionWithAI(options, value, fieldLabel);\n    if (match) {\n      element.value = match.value;\n      console.log(`[AI Job Applier] Selected \"${match.text}\" for value \"${value}\"`);\n    } else {\n      console.log(`[AI Job Applier] No match found for \"${value}\" in dropdown`);\n    }\n  } else {\n    element.value = value;\n  }\n  \n  element.dispatchEvent(inputEvent);\n  element.dispatchEvent(changeEvent);\n  \n  // For React apps, we might need to trigger React's synthetic events\n  if (!(element instanceof HTMLSelectElement)) {\n    const nativeInputValueSetter = Object.getOwnPropertyDescriptor(\n      element.tagName === 'TEXTAREA' ? HTMLTextAreaElement.prototype : HTMLInputElement.prototype, \n      'value'\n    )?.set;\n    \n    if (nativeInputValueSetter) {\n      nativeInputValueSetter.call(element, value);\n      element.dispatchEvent(new Event('input', { bubbles: true }));\n    }\n  }\n}\n\n// Sync version for simple fields (backward compatibility)\nfunction setInputValue(\n  element: HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement, \n  value: string\n): void {\n  const inputEvent = new Event('input', { bubbles: true });\n  const changeEvent = new Event('change', { bubbles: true });\n  \n  if (element instanceof HTMLSelectElement) {\n    const options = Array.from(element.options).filter(opt => opt.value);\n    const match = findBestOption(options, value);\n    if (match) {\n      element.value = match.value;\n    }\n  } else {\n    element.value = value;\n  }\n  \n  element.dispatchEvent(inputEvent);\n  element.dispatchEvent(changeEvent);\n}\n\n// Fill all detected fields\nexport async function fillAllFields(\n  fields: DetectedField[],\n  profile: UserProfile,\n  options: { useAI: boolean; onProgress?: (filled: number, total: number) => void } = { useAI: true }\n): Promise<{ filled: number; failed: string[] }> {\n  let filled = 0;\n  const failed: string[] = [];\n  \n  for (let i = 0; i < fields.length; i++) {\n    const field = fields[i];\n    \n    // Skip unknown fields\n    if (field.fieldType === 'unknown') continue;\n    \n    // Skip file inputs (resume upload needs special handling)\n    if (field.element.type === 'file') continue;\n    \n    const success = await fillField(field, profile, options);\n    \n    if (success) {\n      filled++;\n      highlightField(field.element, 'success');\n    } else {\n      failed.push(field.label || field.fieldType);\n      highlightField(field.element, 'error');\n    }\n    \n    options.onProgress?.(i + 1, fields.length);\n    \n    // Small delay between fields to avoid rate limiting / detection\n    await sleep(100);\n  }\n  \n  // Send webhook notification if enabled\n  try {\n    const settings = await storage.getSettings();\n    if (settings.webhookEnabled) {\n      const jobInfo = extractJobInfo();\n      const totalFields = fields.filter(f => f.fieldType !== 'unknown' && f.element.type !== 'file').length;\n      \n      await sendWebhookNotification({\n        jobTitle: jobInfo.jobTitle || 'Unknown Position',\n        company: jobInfo.company || 'Unknown Company',\n        url: window.location.href,\n        fieldsFilledCount: filled,\n        totalFields: totalFields,\n        timestamp: new Date().toISOString(),\n        status: failed.length === 0 ? 'success' : filled > 0 ? 'partial' : 'error',\n        errorMessage: failed.length > 0 ? `Failed fields: ${failed.join(', ')}` : undefined\n      }, settings.webhookUrl || undefined);\n    }\n  } catch (error) {\n    console.log('[AI Job Applier] Webhook notification error:', error);\n  }\n  \n  return { filled, failed };\n}\n\n// Highlight field to show status\nfunction highlightField(element: HTMLElement, status: 'success' | 'error' | 'pending'): void {\n  const colors = {\n    success: '#10b981',  // green\n    error: '#ef4444',    // red\n    pending: '#f59e0b',  // yellow\n  };\n  \n  element.style.boxShadow = `0 0 0 2px ${colors[status]}`;\n  element.style.transition = 'box-shadow 0.3s ease';\n  \n  // Remove highlight after 3 seconds\n  setTimeout(() => {\n    element.style.boxShadow = '';\n  }, 3000);\n}\n\n// Sleep helper\nfunction sleep(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n// Preview what would be filled (without actually filling)\nexport function previewFill(\n  fields: DetectedField[],\n  profile: UserProfile\n): Array<{ label: string; value: string; fieldType: FieldType }> {\n  return fields\n    .filter(f => f.fieldType !== 'unknown')\n    .map(field => {\n      const value = getFieldValue(field.fieldType, profile);\n      return {\n        label: field.label || field.fieldType,\n        value: value || (field.fieldType === 'openEnded' ? '[AI Generated]' : '[Unknown]'),\n        fieldType: field.fieldType,\n      };\n    });\n}\n","/**\n * Application Logger\n * \n * Comprehensive logging for every job application with detailed tracking.\n * Stores application history, field-level details, and analytics.\n */\n\nimport { generateId } from './storage';\n\n// Storage key\nconst APPLICATIONS_LOG_KEY = 'applicationsLog';\nconst MAX_LOG_ENTRIES = 500;\n\n// Application log entry with full details\nexport interface ApplicationLogEntry {\n  id: string;\n  jobUrl: string;\n  jobTitle: string;\n  company: string;\n  \n  // Field tracking\n  fieldsDetected: number;\n  fieldsFilled: number;\n  fieldsSkipped: number;\n  fieldDetails: FieldDetail[];\n  \n  // Status\n  status: 'filled' | 'submitted' | 'error' | 'partial' | 'review-stopped';\n  mode: 'manual' | 'one-click' | 'full-auto' | 'swarm';\n  stoppedAtReview: boolean;\n  \n  // Timing\n  timestamp: string;\n  durationMs?: number;\n  \n  // Errors\n  errors: string[];\n  \n  // User feedback (populated later)\n  feedback?: ApplicationFeedback;\n  \n  // Source info\n  source?: {\n    platform: 'linkedin' | 'greenhouse' | 'lever' | 'workday' | 'other';\n    pageTitle: string;\n    domain: string;\n  };\n}\n\nexport interface FieldDetail {\n  fieldType: string;\n  label: string;\n  filled: boolean;\n  value?: string;  // Only stored if user opts in (privacy)\n  aiGenerated?: boolean;\n  confidence?: number;\n}\n\nexport interface ApplicationFeedback {\n  rating: 1 | 2 | 3 | 4 | 5;\n  correctFields: string[];\n  incorrectFields: string[];\n  notes?: string;\n  submittedAt: string;\n}\n\n// Analytics summary\nexport interface ApplicationAnalytics {\n  totalApplications: number;\n  successfulFills: number;\n  submissions: number;\n  errors: number;\n  averageFieldsFilled: number;\n  byPlatform: Record<string, number>;\n  byCompany: Record<string, number>;\n  byDate: Record<string, number>;\n  topErrors: Array<{ error: string; count: number }>;\n  fieldAccuracy: Record<string, { filled: number; correct: number }>;\n}\n\n/**\n * Log a new application\n */\nexport async function logApplication(entry: ApplicationLogEntry): Promise<void> {\n  const logs = await getApplicationLogs();\n  \n  // Add source info if not provided\n  if (!entry.source) {\n    entry.source = {\n      platform: detectPlatform(entry.jobUrl),\n      pageTitle: typeof document !== 'undefined' ? document.title : '',\n      domain: new URL(entry.jobUrl).hostname,\n    };\n  }\n  \n  // Ensure ID\n  if (!entry.id) {\n    entry.id = generateId();\n  }\n  \n  // Add to beginning of array\n  logs.unshift(entry);\n  \n  // Trim to max size\n  if (logs.length > MAX_LOG_ENTRIES) {\n    logs.length = MAX_LOG_ENTRIES;\n  }\n  \n  await chrome.storage.local.set({ [APPLICATIONS_LOG_KEY]: logs });\n  \n  // Also send to webhook if enabled\n  await sendLogWebhook(entry);\n  \n  console.log('[AI Job Applier] Application logged:', entry.jobTitle, '@', entry.company);\n}\n\n/**\n * Get all application logs\n */\nexport async function getApplicationLogs(): Promise<ApplicationLogEntry[]> {\n  const result = await chrome.storage.local.get(APPLICATIONS_LOG_KEY);\n  return result[APPLICATIONS_LOG_KEY] || [];\n}\n\n/**\n * Get application by ID\n */\nexport async function getApplicationById(id: string): Promise<ApplicationLogEntry | null> {\n  const logs = await getApplicationLogs();\n  return logs.find(log => log.id === id) || null;\n}\n\n/**\n * Update an existing application log entry\n */\nexport async function updateApplicationLog(\n  id: string, \n  updates: Partial<ApplicationLogEntry>\n): Promise<boolean> {\n  const logs = await getApplicationLogs();\n  const index = logs.findIndex(log => log.id === id);\n  \n  if (index === -1) return false;\n  \n  logs[index] = { ...logs[index], ...updates };\n  await chrome.storage.local.set({ [APPLICATIONS_LOG_KEY]: logs });\n  \n  return true;\n}\n\n/**\n * Add feedback to an application\n */\nexport async function addApplicationFeedback(\n  id: string,\n  feedback: ApplicationFeedback\n): Promise<boolean> {\n  return updateApplicationLog(id, { feedback });\n}\n\n/**\n * Delete an application log entry\n */\nexport async function deleteApplicationLog(id: string): Promise<boolean> {\n  const logs = await getApplicationLogs();\n  const filtered = logs.filter(log => log.id !== id);\n  \n  if (filtered.length === logs.length) return false;\n  \n  await chrome.storage.local.set({ [APPLICATIONS_LOG_KEY]: filtered });\n  return true;\n}\n\n/**\n * Clear all application logs\n */\nexport async function clearApplicationLogs(): Promise<void> {\n  await chrome.storage.local.remove(APPLICATIONS_LOG_KEY);\n}\n\n/**\n * Get applications filtered by various criteria\n */\nexport async function queryApplications(query: {\n  status?: ApplicationLogEntry['status'];\n  mode?: ApplicationLogEntry['mode'];\n  company?: string;\n  platform?: string;\n  startDate?: string;\n  endDate?: string;\n  hasErrors?: boolean;\n  hasFeedback?: boolean;\n  limit?: number;\n}): Promise<ApplicationLogEntry[]> {\n  let logs = await getApplicationLogs();\n  \n  if (query.status) {\n    logs = logs.filter(log => log.status === query.status);\n  }\n  \n  if (query.mode) {\n    logs = logs.filter(log => log.mode === query.mode);\n  }\n  \n  if (query.company) {\n    const company = query.company.toLowerCase();\n    logs = logs.filter(log => log.company.toLowerCase().includes(company));\n  }\n  \n  if (query.platform) {\n    logs = logs.filter(log => log.source?.platform === query.platform);\n  }\n  \n  if (query.startDate) {\n    logs = logs.filter(log => log.timestamp >= query.startDate!);\n  }\n  \n  if (query.endDate) {\n    logs = logs.filter(log => log.timestamp <= query.endDate!);\n  }\n  \n  if (query.hasErrors !== undefined) {\n    logs = logs.filter(log => \n      query.hasErrors ? log.errors.length > 0 : log.errors.length === 0\n    );\n  }\n  \n  if (query.hasFeedback !== undefined) {\n    logs = logs.filter(log => \n      query.hasFeedback ? log.feedback !== undefined : log.feedback === undefined\n    );\n  }\n  \n  if (query.limit) {\n    logs = logs.slice(0, query.limit);\n  }\n  \n  return logs;\n}\n\n/**\n * Get analytics summary\n */\nexport async function getApplicationAnalytics(): Promise<ApplicationAnalytics> {\n  const logs = await getApplicationLogs();\n  \n  const analytics: ApplicationAnalytics = {\n    totalApplications: logs.length,\n    successfulFills: logs.filter(l => l.status === 'filled' || l.status === 'submitted').length,\n    submissions: logs.filter(l => l.status === 'submitted').length,\n    errors: logs.filter(l => l.status === 'error').length,\n    averageFieldsFilled: 0,\n    byPlatform: {},\n    byCompany: {},\n    byDate: {},\n    topErrors: [],\n    fieldAccuracy: {},\n  };\n  \n  // Calculate averages and distributions\n  let totalFields = 0;\n  const errorCounts: Record<string, number> = {};\n  \n  for (const log of logs) {\n    totalFields += log.fieldsFilled;\n    \n    // By platform\n    const platform = log.source?.platform || 'other';\n    analytics.byPlatform[platform] = (analytics.byPlatform[platform] || 0) + 1;\n    \n    // By company\n    analytics.byCompany[log.company] = (analytics.byCompany[log.company] || 0) + 1;\n    \n    // By date (YYYY-MM-DD)\n    const date = log.timestamp.split('T')[0];\n    analytics.byDate[date] = (analytics.byDate[date] || 0) + 1;\n    \n    // Errors\n    for (const error of log.errors) {\n      errorCounts[error] = (errorCounts[error] || 0) + 1;\n    }\n    \n    // Field accuracy (if we have feedback)\n    if (log.feedback) {\n      for (const field of log.fieldDetails) {\n        if (!analytics.fieldAccuracy[field.fieldType]) {\n          analytics.fieldAccuracy[field.fieldType] = { filled: 0, correct: 0 };\n        }\n        analytics.fieldAccuracy[field.fieldType].filled++;\n        if (log.feedback.correctFields.includes(field.fieldType)) {\n          analytics.fieldAccuracy[field.fieldType].correct++;\n        }\n      }\n    }\n  }\n  \n  analytics.averageFieldsFilled = logs.length > 0 ? totalFields / logs.length : 0;\n  \n  // Sort and get top errors\n  analytics.topErrors = Object.entries(errorCounts)\n    .map(([error, count]) => ({ error, count }))\n    .sort((a, b) => b.count - a.count)\n    .slice(0, 10);\n  \n  return analytics;\n}\n\n/**\n * Export logs as JSON\n */\nexport async function exportLogsAsJson(): Promise<string> {\n  const logs = await getApplicationLogs();\n  return JSON.stringify(logs, null, 2);\n}\n\n/**\n * Export logs as CSV\n */\nexport async function exportLogsAsCsv(): Promise<string> {\n  const logs = await getApplicationLogs();\n  \n  const headers = [\n    'ID',\n    'Timestamp',\n    'Job Title',\n    'Company',\n    'URL',\n    'Platform',\n    'Status',\n    'Mode',\n    'Fields Detected',\n    'Fields Filled',\n    'Fields Skipped',\n    'Stopped at Review',\n    'Errors',\n    'Feedback Rating',\n  ];\n  \n  const rows = logs.map(log => [\n    log.id,\n    log.timestamp,\n    `\"${log.jobTitle.replace(/\"/g, '\"\"')}\"`,\n    `\"${log.company.replace(/\"/g, '\"\"')}\"`,\n    log.jobUrl,\n    log.source?.platform || 'unknown',\n    log.status,\n    log.mode,\n    log.fieldsDetected,\n    log.fieldsFilled,\n    log.fieldsSkipped,\n    log.stoppedAtReview ? 'Yes' : 'No',\n    `\"${log.errors.join('; ').replace(/\"/g, '\"\"')}\"`,\n    log.feedback?.rating || '',\n  ]);\n  \n  return [headers.join(','), ...rows.map(r => r.join(','))].join('\\n');\n}\n\n/**\n * Get recent applications (last N entries)\n */\nexport async function getRecentApplications(count: number = 10): Promise<ApplicationLogEntry[]> {\n  const logs = await getApplicationLogs();\n  return logs.slice(0, count);\n}\n\n/**\n * Get applications for today\n */\nexport async function getTodayApplications(): Promise<ApplicationLogEntry[]> {\n  const today = new Date().toISOString().split('T')[0];\n  return queryApplications({ startDate: today });\n}\n\n/**\n * Check if we've already applied to a job\n */\nexport async function hasAppliedTo(jobUrl: string): Promise<boolean> {\n  const logs = await getApplicationLogs();\n  return logs.some(log => \n    log.jobUrl === jobUrl && \n    (log.status === 'filled' || log.status === 'submitted')\n  );\n}\n\n/**\n * Get application history for a company\n */\nexport async function getCompanyHistory(company: string): Promise<ApplicationLogEntry[]> {\n  return queryApplications({ company });\n}\n\n// Helper functions\nfunction detectPlatform(url: string): 'linkedin' | 'greenhouse' | 'lever' | 'workday' | 'other' {\n  const hostname = new URL(url).hostname.toLowerCase();\n  \n  if (hostname.includes('linkedin.com')) return 'linkedin';\n  if (hostname.includes('greenhouse.io')) return 'greenhouse';\n  if (hostname.includes('lever.co')) return 'lever';\n  if (hostname.includes('workday.com') || hostname.includes('myworkdayjobs.com')) return 'workday';\n  \n  return 'other';\n}\n\n/**\n * Send log entry to webhook (if configured)\n */\nasync function sendLogWebhook(entry: ApplicationLogEntry): Promise<void> {\n  try {\n    const result = await chrome.storage.local.get('settings');\n    const settings = result.settings || {};\n    \n    if (!settings.webhookEnabled || !settings.webhookUrl) {\n      return;\n    }\n    \n    const statusEmoji = {\n      'filled': '‚úÖ',\n      'submitted': 'üöÄ',\n      'error': '‚ùå',\n      'partial': '‚ö†Ô∏è',\n      'review-stopped': 'üìã',\n    };\n    \n    const statusColor = {\n      'filled': 0x10b981,\n      'submitted': 0x3b82f6,\n      'error': 0xef4444,\n      'partial': 0xf59e0b,\n      'review-stopped': 0x8b5cf6,\n    };\n    \n    const embed = {\n      title: `${statusEmoji[entry.status]} ${entry.status.toUpperCase()}: ${entry.jobTitle}`,\n      color: statusColor[entry.status],\n      fields: [\n        { name: 'üè¢ Company', value: entry.company, inline: true },\n        { name: 'üìä Mode', value: entry.mode, inline: true },\n        { name: 'üìù Fields', value: `${entry.fieldsFilled}/${entry.fieldsDetected}`, inline: true },\n        { name: 'üîó URL', value: entry.jobUrl.slice(0, 100), inline: false },\n      ],\n      timestamp: entry.timestamp,\n      footer: { text: `Platform: ${entry.source?.platform || 'unknown'}` },\n    };\n    \n    if (entry.errors.length > 0) {\n      embed.fields.push({\n        name: '‚ö†Ô∏è Errors',\n        value: entry.errors.slice(0, 3).join('\\n').slice(0, 200),\n        inline: false,\n      });\n    }\n    \n    await fetch(settings.webhookUrl, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ embeds: [embed] }),\n    });\n    \n  } catch (error) {\n    console.log('[AI Job Applier] Log webhook error:', error);\n  }\n}\n\n// Export storage key for direct access if needed\nexport { APPLICATIONS_LOG_KEY };\n","import { detectFormFields, detectJobInfo, detectOpenEndedQuestions } from './detector';\nimport { fillAllFields, previewFill, fillField } from './filler';\nimport { storage, generateId } from '../lib/storage';\nimport { DetectedField } from '../lib/types';\nimport { logApplication } from '../lib/application-logger';\nimport { recordAcceptance, recordCorrection } from '../lib/feedback-learner';\n\n// State\nlet detectedFields: DetectedField[] = [];\nlet floatingButton: HTMLElement | null = null;\n\n// Initialize content script\nasync function init() {\n  console.log('[AI Job Applier] Content script loaded');\n  \n  // Wait for page to fully load\n  if (document.readyState !== 'complete') {\n    await new Promise(resolve => window.addEventListener('load', resolve));\n  }\n  \n  // Detect fields\n  detectedFields = detectFormFields();\n  console.log(`[AI Job Applier] Detected ${detectedFields.length} form fields`);\n  \n  // Create floating action button\n  createFloatingButton();\n  \n  // Listen for messages from popup\n  chrome.runtime.onMessage.addListener(handleMessage);\n}\n\n// Create floating button\nfunction createFloatingButton() {\n  if (floatingButton) return;\n  \n  floatingButton = document.createElement('div');\n  floatingButton.id = 'ai-job-applier-fab';\n  floatingButton.innerHTML = `\n    <div class=\"ai-job-applier-fab-content\">\n      <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n        <path d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01\"/>\n      </svg>\n      <span class=\"ai-job-applier-fab-badge\">${detectedFields.length}</span>\n    </div>\n  `;\n  \n  floatingButton.addEventListener('click', () => {\n    showQuickMenu();\n  });\n  \n  document.body.appendChild(floatingButton);\n}\n\n// Show quick menu\nfunction showQuickMenu() {\n  const existing = document.getElementById('ai-job-applier-menu');\n  if (existing) {\n    existing.remove();\n    return;\n  }\n  \n  const jobInfo = detectJobInfo();\n  const menu = document.createElement('div');\n  menu.id = 'ai-job-applier-menu';\n  menu.innerHTML = `\n    <div class=\"ai-job-applier-menu-header\">\n      <h3>AI Job Applier</h3>\n      ${jobInfo.company ? `<p>${jobInfo.title} at ${jobInfo.company}</p>` : ''}\n    </div>\n    <div class=\"ai-job-applier-menu-stats\">\n      <span>${detectedFields.length} fields detected</span>\n    </div>\n    <div class=\"ai-job-applier-menu-actions\">\n      <button id=\"ai-fill-all\" class=\"ai-btn primary\">\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <polyline points=\"9 11 12 14 22 4\"></polyline>\n          <path d=\"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11\"></path>\n        </svg>\n        Auto-Fill All\n      </button>\n      <button id=\"ai-preview\" class=\"ai-btn secondary\">\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <path d=\"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z\"></path>\n          <circle cx=\"12\" cy=\"12\" r=\"3\"></circle>\n        </svg>\n        Preview\n      </button>\n      <button id=\"ai-settings\" class=\"ai-btn secondary\">\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <circle cx=\"12\" cy=\"12\" r=\"3\"></circle>\n          <path d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"></path>\n        </svg>\n        Settings\n      </button>\n    </div>\n    <button class=\"ai-job-applier-menu-close\">√ó</button>\n  `;\n  \n  document.body.appendChild(menu);\n  \n  // Event listeners\n  menu.querySelector('#ai-fill-all')?.addEventListener('click', handleFillAll);\n  menu.querySelector('#ai-preview')?.addEventListener('click', handlePreview);\n  menu.querySelector('#ai-settings')?.addEventListener('click', () => {\n    chrome.runtime.openOptionsPage();\n  });\n  menu.querySelector('.ai-job-applier-menu-close')?.addEventListener('click', () => {\n    menu.remove();\n  });\n}\n\n// Handle fill all\nasync function handleFillAll() {\n  const profile = await storage.getProfile();\n  \n  if (!profile.firstName || !profile.email) {\n    alert('Please set up your profile first! Click the Settings button.');\n    return;\n  }\n  \n  const statusEl = document.querySelector('.ai-job-applier-menu-stats');\n  if (statusEl) {\n    statusEl.innerHTML = '<span class=\"loading\">Filling forms...</span>';\n  }\n  \n  const { filled, failed } = await fillAllFields(detectedFields, profile, {\n    useAI: true,\n    onProgress: (current, total) => {\n      if (statusEl) {\n        statusEl.innerHTML = `<span>Filled ${current}/${total} fields...</span>`;\n      }\n    },\n  });\n  \n  if (statusEl) {\n    statusEl.innerHTML = `<span class=\"success\">‚úì Filled ${filled} fields</span>`;\n    if (failed.length > 0) {\n      statusEl.innerHTML += `<br><span class=\"error\">Could not fill: ${failed.join(', ')}</span>`;\n    }\n  }\n}\n\n// Handle preview\nasync function handlePreview() {\n  const profile = await storage.getProfile();\n  const preview = previewFill(detectedFields, profile);\n  \n  const previewHtml = preview.map(p => `\n    <div class=\"preview-item\">\n      <strong>${p.label}</strong>\n      <span>${p.value || '(empty)'}</span>\n    </div>\n  `).join('');\n  \n  const modal = document.createElement('div');\n  modal.id = 'ai-job-applier-preview';\n  modal.innerHTML = `\n    <div class=\"preview-content\">\n      <h3>Preview Auto-Fill</h3>\n      <div class=\"preview-list\">${previewHtml}</div>\n      <button class=\"ai-btn primary\" id=\"confirm-fill\">Fill Now</button>\n      <button class=\"ai-btn secondary\" id=\"cancel-fill\">Cancel</button>\n    </div>\n  `;\n  \n  document.body.appendChild(modal);\n  \n  modal.querySelector('#confirm-fill')?.addEventListener('click', async () => {\n    modal.remove();\n    await handleFillAll();\n  });\n  \n  modal.querySelector('#cancel-fill')?.addEventListener('click', () => {\n    modal.remove();\n  });\n}\n\n// Handle messages from popup/background\nfunction handleMessage(\n  message: any, \n  sender: chrome.runtime.MessageSender, \n  sendResponse: (response: any) => void\n) {\n  switch (message.type) {\n    case 'GET_FIELDS':\n      sendResponse({ \n        fields: detectedFields.map(f => ({\n          fieldType: f.fieldType,\n          label: f.label,\n          isRequired: f.isRequired,\n        })),\n        jobInfo: detectJobInfo(),\n      });\n      break;\n      \n    case 'FILL_ALL':\n      handleFillAll().then(() => sendResponse({ success: true }));\n      return true; // async response\n      \n    case 'FILL_FIELD':\n      storage.getProfile().then(profile => {\n        const field = detectedFields.find(f => f.label === message.label);\n        if (field) {\n          fillField(field, profile).then(success => sendResponse({ success }));\n        }\n      });\n      return true;\n      \n    case 'REFRESH_DETECTION':\n      detectedFields = detectFormFields();\n      sendResponse({ count: detectedFields.length });\n      break;\n      \n    case 'AUTO_APPLY':\n      // Handle auto-apply from swarm mode\n      handleAutoApply(message.config).then(result => {\n        sendResponse({ result });\n      });\n      return true;\n  }\n}\n\n// Handle auto-apply (for swarm mode and one-click)\nasync function handleAutoApply(config: any): Promise<any> {\n  const profile = await storage.getProfile();\n  const jobInfo = detectJobInfo();\n  \n  // Re-detect fields on fresh page\n  detectedFields = detectFormFields();\n  \n  const result = {\n    success: false,\n    jobUrl: window.location.href,\n    jobTitle: jobInfo.title || 'Unknown Position',\n    company: jobInfo.company || 'Unknown Company',\n    fieldsFilled: 0,\n    totalFields: detectedFields.length,\n    stoppedAtReview: false,\n    submitted: false,\n    errors: [] as string[],\n    timestamp: new Date().toISOString(),\n  };\n  \n  if (!profile.firstName || !profile.email) {\n    result.errors.push('Profile incomplete');\n    return result;\n  }\n  \n  if (detectedFields.length === 0) {\n    result.errors.push('No form fields detected');\n    return result;\n  }\n  \n  try {\n    // Fill all fields\n    const { filled, failed } = await fillAllFields(detectedFields, profile, {\n      useAI: true,\n    });\n    \n    result.fieldsFilled = filled;\n    result.errors = failed;\n    result.success = filled > 0;\n    \n    // Log the application\n    await logApplication({\n      id: generateId(),\n      jobUrl: result.jobUrl,\n      jobTitle: result.jobTitle,\n      company: result.company,\n      fieldsDetected: result.totalFields,\n      fieldsFilled: result.fieldsFilled,\n      fieldsSkipped: failed.length,\n      status: result.success ? 'filled' : 'error',\n      mode: config?.submitAutomatically ? 'full-auto' : 'one-click',\n      stoppedAtReview: false,\n      timestamp: result.timestamp,\n      errors: result.errors,\n      fieldDetails: detectedFields.map(f => ({\n        fieldType: f.fieldType,\n        label: f.label,\n        filled: !failed.includes(f.label || f.fieldType),\n      })),\n    });\n    \n    // Check for review page and handle submission\n    if (config?.submitAutomatically) {\n      const submitBtn = findSubmitButton();\n      if (submitBtn) {\n        submitBtn.click();\n        result.submitted = true;\n      }\n    } else {\n      // Check if we should stop at review\n      if (isReviewPage()) {\n        result.stoppedAtReview = true;\n        showReviewNotification(result);\n      }\n    }\n    \n  } catch (error) {\n    result.errors.push(error instanceof Error ? error.message : 'Unknown error');\n  }\n  \n  return result;\n}\n\n// Find submit button on page\nfunction findSubmitButton(): HTMLButtonElement | null {\n  const selectors = [\n    'button[type=\"submit\"]',\n    'input[type=\"submit\"]',\n    'button[data-qa=\"submit-button\"]',\n    'button[data-automation-id=\"submit\"]',\n    '#submit-btn',\n    '.submit-button',\n    'button.btn-submit',\n  ];\n  \n  for (const selector of selectors) {\n    const btn = document.querySelector<HTMLButtonElement>(selector);\n    if (btn) return btn;\n  }\n  \n  return null;\n}\n\n// Check if current page is a review page\nfunction isReviewPage(): boolean {\n  const pageText = document.body.innerText.toLowerCase();\n  const reviewIndicators = [\n    'review your application',\n    'review application',\n    'submit application',\n    'confirm submission',\n    'review and submit',\n    'application summary',\n  ];\n  \n  return reviewIndicators.some(indicator => pageText.includes(indicator));\n}\n\n// Show notification when stopped at review page\nfunction showReviewNotification(result: any): void {\n  const notification = document.createElement('div');\n  notification.id = 'ai-apply-review-notification';\n  notification.innerHTML = `\n    <div style=\"\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      padding: 20px;\n      border-radius: 12px;\n      box-shadow: 0 4px 20px rgba(0,0,0,0.3);\n      z-index: 9999999;\n      max-width: 350px;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    \">\n      <h3 style=\"margin: 0 0 10px; font-size: 16px;\">üìã Ready for Review</h3>\n      <p style=\"margin: 5px 0; font-size: 14px;\"><strong>${result.jobTitle}</strong></p>\n      <p style=\"margin: 5px 0; font-size: 14px;\">${result.company}</p>\n      <p style=\"margin: 10px 0 0; font-size: 13px; opacity: 0.9;\">\n        Filled ${result.fieldsFilled}/${result.totalFields} fields\n      </p>\n      <button onclick=\"this.parentElement.parentElement.remove()\" style=\"\n        margin-top: 12px;\n        padding: 8px 16px;\n        background: white;\n        color: #667eea;\n        border: none;\n        border-radius: 6px;\n        cursor: pointer;\n        font-weight: 600;\n      \">Got it</button>\n    </div>\n  `;\n  document.body.appendChild(notification);\n  \n  // Auto-dismiss after 10 seconds\n  setTimeout(() => notification.remove(), 10000);\n}\n\n// Initialize\ninit();\n"],"names":["_a"],"mappings":"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"}